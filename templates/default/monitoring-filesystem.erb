# CHEF MANAGED FILE: DO NOT EDIT
# Controlling Cookbook: <%= @cookbook_name %>
#

type: agent.filesystem
label: Filesystem check on <%= node['platformstack']['cloud_monitoring']['filesystem']['target'] %>
disabled: <%= node['platformstack']['cloud_monitoring']['filesystem']['disabled'] %>
period: <%= node['platformstack']['cloud_monitoring']['filesystem']['period'] %>
timeout: <%= node['platformstack']['cloud_monitoring']['filesystem']['timeout'] %>
details:
  target: <%= node['platformstack']['cloud_monitoring']['filesystem']['target'] %>
<% if node['platformstack']['cloud_monitoring']['filesystem']['alarm'] == true %>
alarms:
    alarm-disk-size:
        label: usage on <%= node['platformstack']['cloud_monitoring']['filesystem']['target'] %>
        notification_plan_id: npTechnicalContactsEmail
        criteria: |
            if (percentage(metric['used'], metric['total']) > <%= node['platformstack']['cloud_monitoring']['filesystem']['crit']  %> ) {
                return new AlarmStatus(CRITICAL, 'Disk usage is above <%= node['platformstack']['cloud_monitoring']['filesystem']['crit'] %>%, #{used} out of #{total}');
            }
            if (percentage(metric['used'], metric['total']) > <%= node['platformstack']['cloud_monitoring']['filesystem']['warn'] %> ) {
                return new AlarmStatus(WARNING, 'Disk usage is above <%= node['platformstack']['cloud_monitoring']['filesystem']['warn'] %>%, #{used} out of #{total}');
            }
<% end %>

